<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê—É–∫—Ü–∏–æ–Ω –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    :root {
      --primary: #FF5722;
      --secondary: #607D8B;
      --accent: #FFC107;
      --dark: #263238;
      --light: #ECEFF1;
    }
    
    body {
      font-family: 'Rubik', sans-serif;
      background-color: var(--dark);
      color: var(--light);
      margin: 0;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .logo {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .logo-icon {
      font-size: 4rem;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(45deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 10px 0;
    }
    
    .input-group {
      margin: 20px auto;
      max-width: 400px;
    }
    
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--accent);
      border-radius: 8px;
      background: rgba(0,0,0,0.2);
      color: white;
      font-size: 16px;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 25px 0;
    }
    
    button {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .lobby-list {
      margin-top: 30px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 10px;
    }
    
    .lobby-item {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .lobby-item:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }
    
    .notification.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="screen" id="start-screen">
      <div class="logo animate__animated animate__bounceIn">
        <div class="logo-icon">üì¶</div>
        <h1>–ê–£–ö–¶–ò–û–ù –ö–û–ù–¢–ï–ô–ù–ï–†–û–í</h1>
        <p>–°—Ç–∞–≤—å. –í—ã–∏–≥—Ä—ã–≤–∞–π. –î–æ–º–∏–Ω–∏—Ä—É–π.</p>
      </div>
      
      <div class="input-group">
        <input type="text" id="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º" maxlength="12" autocomplete="off">
      </div>
      
      <div class="button-group">
        <button id="create-lobby" class="btn-primary" disabled>
          <span>‚ûï</span> –°–û–ó–î–ê–¢–¨ –õ–û–ë–ë–ò
        </button>
        <button id="join-lobby" class="btn-secondary" disabled>
          <span>üë•</span> –ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø
        </button>
      </div>
      
      <div class="lobby-list" id="lobby-list">
        <p id="lobby-status">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–±–±–∏...</p>
        <!-- –õ–æ–±–±–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  
  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–Æ!)
  const firebaseConfig = {
    apiKey: "AIzaSyCJuTuxuPhYxCjZXqMZWJTTmLrgxVkTGBY", // Web API Key
    authDomain: "container-auction.firebaseapp.com",
    databaseURL: "https://container-auction.firebaseio.com", // URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    projectId: "container-auction",
    storageBucket: "container-auction.appspot.com",
    messagingSenderId: "907236645178",
    appId: "1:907236645178:web:7d5393a8592fbb81b7c442"
  };


    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    const elements = {
      nicknameInput: document.getElementById('nickname'),
      createLobbyBtn: document.getElementById('create-lobby'),
      joinLobbyBtn: document.getElementById('join-lobby'),
      lobbyList: document.getElementById('lobby-list'),
      lobbyStatus: document.getElementById('lobby-status'),
      notification: document.getElementById('notification')
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const state = {
      currentUser: null,
      lobbies: []
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    async function initApp() {
      try {
        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await auth.signInAnonymously();
        
        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        auth.onAuthStateChanged((user) => {
          if (user) {
            state.currentUser = user;
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:", user.uid);
            setupEventListeners();
            loadLobbies();
          } else {
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
          }
        });
        
      } catch (error) {
        showNotification("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: " + error.message, "error");
        console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
      }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
      // –í–≤–æ–¥ –Ω–∏–∫–∞
      elements.nicknameInput.addEventListener('input', () => {
        const nickname = elements.nicknameInput.value.trim();
        const isValid = nickname.length >= 2;
        
        elements.createLobbyBtn.disabled = !isValid;
        elements.joinLobbyBtn.disabled = !isValid;
      });

      // –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–±–±–∏
      elements.createLobbyBtn.addEventListener('click', createLobby);
      
      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ª–æ–±–±–∏
      elements.joinLobbyBtn.addEventListener('click', () => {
        elements.lobbyList.style.display = 'block';
        loadLobbies();
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–æ–±–±–∏
    async function createLobby() {
      const nickname = elements.nicknameInput.value.trim();
      if (!nickname) {
        showNotification("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º!", "error");
        return;
      }

      try {
        const lobbyId = generateLobbyId();
        const playerData = {
          name: nickname,
          money: 10000,
          isHost: true
        };

        // –°–æ–∑–¥–∞–µ–º –ª–æ–±–±–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        const updates = {};
        updates[`lobbies/${lobbyId}/host`] = state.currentUser.uid;
        updates[`lobbies/${lobbyId}/players/${state.currentUser.uid}`] = playerData;
        updates[`lobbies/${lobbyId}/settings`] = {
          maxPlayers: 8,
          timer: 30,
          containers: 10,
          createdAt: firebase.database.ServerValue.TIMESTAMP
        };
        updates[`lobbies/${lobbyId}/status`] = "waiting";

        await db.ref().update(updates);
        
        showNotification(`–õ–æ–±–±–∏ #${lobbyId} —Å–æ–∑–¥–∞–Ω–æ!`);
        setTimeout(() => {
          window.location.href = `lobby.html?id=${lobbyId}`;
        }, 1000);
        
      } catch (error) {
        showNotification("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–æ–±–±–∏: " + error.message, "error");
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–æ–±–±–∏:", error);
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ª–æ–±–±–∏
    async function loadLobbies() {
      try {
        elements.lobbyStatus.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–±–±–∏...";
        
        const snapshot = await db.ref('lobbies')
          .orderByChild('status')
          .equalTo('waiting')
          .once('value');
        
        const lobbies = [];
        snapshot.forEach((childSnapshot) => {
          const lobby = childSnapshot.val();
          lobby.id = childSnapshot.key;
          lobbies.push(lobby);
        });
        
        state.lobbies = lobbies;
        renderLobbies();
        
      } catch (error) {
        elements.lobbyStatus.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–±–±–∏";
        showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–±–±–∏: " + error.message, "error");
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–±–±–∏:", error);
      }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ª–æ–±–±–∏
    function renderLobbies() {
      elements.lobbyList.innerHTML = '';
      
      if (state.lobbies.length === 0) {
        elements.lobbyStatus.textContent = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–±–±–∏. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ!";
        return;
      }
      
      elements.lobbyStatus.textContent = "–î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–±–±–∏:";
      
      state.lobbies.forEach((lobby) => {
        const lobbyItem = document.createElement('div');
        lobbyItem.className = 'lobby-item';
        lobbyItem.innerHTML = `
          <div>
            <strong>–õ–æ–±–±–∏ #${lobby.id}</strong>
            <p>–ò–≥—Ä–æ–∫–æ–≤: ${Object.keys(lobby.players || {}).length}/${lobby.settings.maxPlayers}</p>
          </div>
          <div>–í–µ–¥—É—â–∏–π: ${lobby.players[lobby.host]?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
        `;
        
        lobbyItem.addEventListener('click', () => {
          joinLobby(lobby.id);
        });
        
        elements.lobbyList.appendChild(lobbyItem);
      });
    }

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–±–±–∏
    async function joinLobby(lobbyId) {
      const nickname = elements.nicknameInput.value.trim();
      if (!nickname) {
        showNotification("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º!", "error");
        return;
      }

      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ª–æ–±–±–∏
        const lobbySnapshot = await db.ref(`lobbies/${lobbyId}`).once('value');
        const lobby = lobbySnapshot.val();
        
        if (!lobby) {
          showNotification("–õ–æ–±–±–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!", "error");
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –º–µ—Å—Ç–æ –≤ –ª–æ–±–±–∏
        if (Object.keys(lobby.players || {}).length >= lobby.settings.maxPlayers) {
          showNotification("–õ–æ–±–±–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ!", "error");
          return;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –≤ –ª–æ–±–±–∏
        const playerData = {
          name: nickname,
          money: 10000,
          isHost: false
        };
        
        await db.ref(`lobbies/${lobbyId}/players/${state.currentUser.uid}`).set(playerData);
        
        showNotification(`–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –ª–æ–±–±–∏ #${lobbyId}`);
        setTimeout(() => {
          window.location.href = `lobby.html?id=${lobbyId}`;
        }, 1000);
        
      } catch (error) {
        showNotification("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏: " + error.message, "error");
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:", error);
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showNotification(message, type = "success") {
      const notification = elements.notification;
      notification.textContent = message;
      notification.className = `notification show ${type}`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä ID –ª–æ–±–±–∏
    function generateLobbyId() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let result = '';
      for (let i = 0; i < 6; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
